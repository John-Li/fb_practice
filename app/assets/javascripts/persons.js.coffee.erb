# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://jashkenas.github.com/coffee-script/

$ ->
  counter = 0
  markup = "<tr><td>${id}</td><td>${name}</td></tr>"
  
  $('a#get_person').click -> 
    $.ajax
      dataType: 'json',
      type: 'GET',
      url:  "persons/#{counter}"
      data: 
        id: counter
      success: (data) =>
        parse_data(data)
        counter = data.id
   
  parse_data = (data) =>
    $.template("rowWithName", markup)
    $.tmpl("rowWithName", data).appendTo('.persons tbody')
    
  $('.sort a').click ->
    field = $(this).attr('field')
    order = $(this).attr('order')
    $('.persons tbody').remove()
    $.ajax
      dataType: 'json',
      type: 'GET',
      url:  "persons"
      data:
        field: field
        order: order
      success: (data) =>
        for person in data
          do (person) =>
            $.template("rowWithName", markup)
            $.tmpl("rowWithName", person).appendTo('.persons table')